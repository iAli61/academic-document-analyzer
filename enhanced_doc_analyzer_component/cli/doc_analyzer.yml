$schema: https://azuremlschemas.azureedge.net/latest/commandComponent.schema.json
name: document_analyzer
version: 3
display_name: Document Analyzer
type: command
description: Analyzes multiple PDF documents using Azure Document Intelligence and local processing

inputs:
  input_folder:
    type: uri_folder
    description: Input folder containing PDF files to analyze
  doc_intel_connection_id:
    type: string
    description: Azure ML connection ID for Document Intelligence
  confidence_threshold:
    type: number
    default: 0.7
    description: Confidence threshold for element detection
  min_length:
    type: integer
    default: 10
    description: Minimum text length to consider
  overlap_threshold:
    type: number
    default: 0.5
    description: Threshold for overlap detection
  ignore_roles:
    type: string
    default: pageFooter,footnote
    description: Comma-separated list of roles to ignore

outputs:
  markdown_output_folder:
    type: uri_folder
    description: Folder containing markdown files for each processed PDF
  combined_elements_data:
    type: uri_file
    description: CSV file containing combined elements data from all PDFs
  visualizations_folder:
    type: uri_folder
    description: Folder containing visualization images organized by PDF

environment:
  image: mcr.microsoft.com/azureml/curated/acpt-pytorch-2.2-cuda12.1:18
  conda_file: ../conda.yaml

code: ../

command: >-
  python run.py 
  --input_folder ${{inputs.input_folder}} 
  --doc_intel_connection_id ${{inputs.doc_intel_connection_id}} 
  --confidence_threshold ${{inputs.confidence_threshold}} 
  --min_length ${{inputs.min_length}} 
  --overlap_threshold ${{inputs.overlap_threshold}} 
  --ignore_roles ${{inputs.ignore_roles}} 
  --markdown_output_folder ${{outputs.markdown_output_folder}} 
  --combined_elements_data ${{outputs.combined_elements_data}} 
  --visualizations_folder ${{outputs.visualizations_folder}}